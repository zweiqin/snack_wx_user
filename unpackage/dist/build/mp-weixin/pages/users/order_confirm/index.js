(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/users/order_confirm/index"],{"018d":function(t,e,i){"use strict";i.r(e);var n=i("79a5"),s=i("5e42b");for(var a in s)"default"!==a&&function(t){i.d(e,t,(function(){return s[t]}))}(a);i("14b4");var o,r=i("f0c5"),u=Object(r["a"])(s["default"],n["b"],n["c"],!1,null,"63cd0cb7",null,!1,n["a"],o);e["default"]=u.exports},"14b4":function(t,e,i){"use strict";var n=i("6914"),s=i.n(n);s.a},"5e42b":function(t,e,i){"use strict";i.r(e);var n=i("e60b"),s=i.n(n);for(var a in n)"default"!==a&&function(t){i.d(e,t,(function(){return n[t]}))}(a);e["default"]=s.a},6914:function(t,e,i){},"76d6":function(t,e,i){"use strict";(function(t){i("384f");n(i("66fd"));var e=n(i("018d"));function n(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=i,t(e.default)}).call(this,i("543d")["createPage"])},"79a5":function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){return n}));var n={uniForms:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uni-forms/components/uni-forms/uni-forms")]).then(i.bind(null,"8b28"))},uniFormsItem:function(){return i.e("uni_modules/uni-forms/components/uni-forms-item/uni-forms-item").then(i.bind(null,"403c"))},uniEasyinput:function(){return i.e("uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput").then(i.bind(null,"75b8"))},uniCard:function(){return i.e("uni_modules/uni-card/components/uni-card/uni-card").then(i.bind(null,"3b8c"))},wTimePicker:function(){return i.e("components/w-time-picker/w-time-picker").then(i.bind(null,"1ac5"))}},s=function(){var t=this,e=t.$createElement,i=(t._self._c,(parseFloat(t.priceGroup.totalPrice)+parseFloat(t.priceGroup.vipPrice)).toFixed(2)),n=t.priceGroup.storePostage>0?(parseFloat(t.priceGroup.storePostage)+parseFloat(t.priceGroup.storePostageDiscount)).toFixed(2):null,s=!(t.priceGroup.vipPrice>0&&t.userInfo.vip)||t.pinkId||t.BargainId||t.combinationId||t.seckillId||t.discountId?null:parseFloat(t.priceGroup.vipPrice).toFixed(2),a=t.priceGroup.storePostageDiscount>0?parseFloat(t.priceGroup.storePostageDiscount).toFixed(2):null,o=t.coupon_price>0?parseFloat(t.coupon_price).toFixed(2):null,r=t.integral_price>0?parseFloat(t.integral_price).toFixed(2):null,u=t.totalPrice.toString();t.$mp.data=Object.assign({},{$root:{g0:i,g1:n,g2:s,g3:a,g4:o,g5:r,g6:u}})},a=[]},e60b:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i("62ff"),s=i("0c82"),a=i("5baf"),o=i("9207"),r=i("aa42"),u=(i("0dd7"),i("5047")),c=i("26cb"),d=l(i("9676"));function l(t){return t&&t.__esModule?t:{default:t}}function p(t,e){return y(t)||m(t,e)||f(t,e)||h()}function h(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(t,e){if(t){if("string"===typeof t)return g(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?g(t,e):void 0}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function m(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var i=[],n=!0,s=!1,a=void 0;try{for(var o,r=t[Symbol.iterator]();!(n=(o=r.next()).done);n=!0)if(i.push(o.value),e&&i.length===e)break}catch(u){s=!0,a=u}finally{try{n||null==r["return"]||r["return"]()}finally{if(s)throw a}}return i}}function y(t){if(Array.isArray(t))return t}var _=function(){Promise.all([i.e("common/vendor"),i.e("components/couponListWindow/index")]).then(function(){return resolve(i("d052"))}.bind(null,i)).catch(i.oe)},I=function(){i.e("components/addressWindow/index").then(function(){return resolve(i("fcda"))}.bind(null,i)).catch(i.oe)},v=function(){i.e("components/orderGoods/index").then(function(){return resolve(i("69c0"))}.bind(null,i)).catch(i.oe)},T=function(){Promise.all([i.e("common/vendor"),i.e("components/home/index")]).then(function(){return resolve(i("45a7"))}.bind(null,i)).catch(i.oe)},b=function(){i.e("components/invoicePicker/index").then(function(){return resolve(i("b925"))}.bind(null,i)).catch(i.oe)},$=function(){i.e("components/Authorize").then(function(){return resolve(i("3474"))}.bind(null,i)).catch(i.oe)},P=function(){Promise.all([i.e("common/vendor"),i.e("components/payment/index")]).then(function(){return resolve(i("c4f5"))}.bind(null,i)).catch(i.oe)},k=requirePlugin("chooseLocation"),w={components:{payment:P,invoicePicker:b,couponListWindow:_,addressWindow:I,orderGoods:v,home:T,authorize:$},mixins:[d.default],data:function(){return{dateTime:"",delivery_time_arr:[],is_show_delivery:!0,addressMap:{real_name:"",phone:""},is_suitable:!1,textareaStatus:!0,cartArr:[{name:"微信支付",icon:"icon-weixin2",value:"weixin",title:"使用微信快捷支付",payStatus:1},{name:"支付宝支付",icon:"icon-zhifubao",value:"alipay",title:"使用线上支付宝支付",payStatus:1},{name:"余额支付",icon:"icon-yuezhifu",value:"yue",title:"可用余额:",payStatus:1},{name:"线下支付",icon:"icon-yuezhifu1",value:"offline",title:"选择线下付款方式",payStatus:2}],virtual_type:0,formContent:"",payType:"weixin",openType:1,active:0,coupon:{coupon:!1,list:[],statusTile:"立即使用"},address:{address:!1},addressInfo:{},pinkId:0,addressId:0,couponId:0,cartId:"",BargainId:0,combinationId:0,seckillId:0,discountId:0,userInfo:{},mark:"",couponTitle:"请选择",coupon_price:0,useIntegral:!1,integral_price:0,integral:0,ChangePrice:0,formIds:[],status:0,is_address:!1,toPay:!1,shippingType:0,system_store:{},storePostage:0,advanceId:0,contacts:"",contactsTel:"",mydata:{},storeList:[],store_self_mention:0,cartInfo:[],priceGroup:{},animated:!1,totalPrice:0,integralRatio:"0",pagesUrl:"",orderKey:"",offlinePostage:"",isAuto:!1,isShowAuth:!1,from:"",news:1,invTitle:"不开发票",special_invoice:!1,invoice_func:!1,header_type:"",invShow:!1,invList:[],invChecked:"",urlQuery:"",pay_close:!1,noCoupon:0,valid_count:0,discount_id:0}},computed:(0,c.mapGetters)(["isLogin"]),onReady:function(){var t=this;(0,n.GetDeliveryTime)({}).then((function(e){t.delivery_time_arr=e.data.List,t.is_show_delivery=!1,t.$nextTick((function(){t.is_show_delivery=!0}))})).catch((function(e){return t.$util.Tips({title:e})}))},onLoad:function(t){if(this.from="routine",!t.cartId)return this.$util.Tips({title:"请选择要购买的商品"},{tab:3,url:1});switch(this.couponId=t.couponId||0,this.noCoupon=t.noCoupon||0,this.pinkId=t.pinkId?parseInt(t.pinkId):0,this.addressId=t.addressId||0,this.cartId=t.cartId,this.is_address=!!t.is_address,this.news=t.new&&"0"!==t.new?1:0,this.invChecked=t.invoice_id||"",this.header_type=t.header_type||"1",this.couponTitle=t.couponTitle||"请选择",t.invoice_type){case"1":this.invTitle="增值税电子普通发票";break;case"2":this.invTitle="增值税电子专用发票";break}this.textareaStatus=!0,this.isLogin&&0==this.toPay?(this.getaddressInfo(),this.getConfirm(),this.$nextTick((function(){this.$refs.addressWindow.getAddressList()}))):(0,u.toLogin)()},onShow:function(){var e=this,i=k.getLocation();if(i){this.addressMap=Object.assign(this.addressMap,{latlng:i.latitude+","+i.longitude,lat:i.latitude,lng:i.longitude,poiaddress:i.address,poiname:i.name}),this.$forceUpdate();var s=function(t,e){var i=p(t,2),n=i[0],s=i[1],a=p(e,2),o=a[0],r=a[1],u=n*Math.PI/180,c=o*Math.PI/180,d=u-c,l=s*Math.PI/180-r*Math.PI/180,h=2*Math.asin(Math.sqrt(Math.pow(Math.sin(d/2),2)+Math.cos(u)*Math.cos(c)*Math.pow(Math.sin(l/2),2)));return h*=6378137,h=Math.round(1e4*h)/1e4,h};(0,n.GetEbSystemStoreList)({is_show:1,is_del:0}).then((function(t){e.is_suitable=t.data.items.some((function(t){return s([e.addressMap.lat,e.addressMap.lng],[t.latitude,t.longitude])<2e3}))})).catch((function(t){return e.$util.Tips({title:t})}))}var a=this;t.$on("handClick",(function(e){e&&(a.system_store=e.address),t.$off("handClick")}))},onUnload:function(){k.setLocation(null)},methods:{handlePicker:function(){if(!this.addressMap.latlng||!this.addressMap.poiaddress)return t.showToast({title:"请先选择配送地点",icon:"error",duration:2e3});this.$refs.picker.show()},onConfirm:function(t){this.dateTime=t},onCancel:function(){},invCancel:function(){this.invChecked="",this.invTitle="不开发票",this.invShow=!1},invChange:function(t){this.invChecked=t,this.invShow=!1;var e=this.invList.find((function(e){return e.id===t})),i="";i+=1===e.header_type?"个人":"企业",i+=1===e.type?"普通":"专用",i+="发票",this.invTitle=i},invClose:function(){this.invShow=!1,this.getInvoiceList()},getInvoiceList:function(){var e=this;t.showLoading({title:"正在加载…"}),(0,a.invoiceList)().then((function(i){t.hideLoading(),e.invList=i.data.map((function(t){return t.id=t.id.toString(),t}));var n=e.invList.find((function(t){return t.id==e.invChecked}));if(n){var s="";s+=1===n.header_type?"个人":"企业",s+=1===n.type?"普通":"专用",s+="发票",e.invTitle=s}})).catch((function(e){t.showToast({title:e,icon:"none"})}))},goInvoice:function(){this.getInvoiceList(),this.invShow=!0,this.urlQuery="new=".concat(this.news,"&cartId=").concat(this.cartId,"&pinkId=").concat(this.pinkId,"&couponId=").concat(this.couponId,"&addressId=").concat(this.addressId,"&specialInvoice=").concat(this.special_invoice,"&couponTitle=").concat(this.couponTitle)},onLoadFun:function(){this.getaddressInfo(),this.getConfirm()},onChangeFun:function(t){var e=t,i=e.action||null,n=void 0!=e.value?e.value:null;i&&this[i]&&this[i](n)},payClose:function(){this.pay_close=!1},goPay:function(){var t=this;if(0==t.shippingType){if(!t.addressMap.poiaddress&&!t.shippingType&&!t.virtual_type)return t.$util.Tips({title:"请选择收货地址"});if(!t.addressMap.real_name||!t.addressMap.phone)return t.$util.Tips({title:"请输入收货人姓名和收货人手机号"});if(!this.is_suitable&&!t.shippingType)return t.$util.Tips({title:"超过了配送范围！"});if(!t.dateTime)return t.$util.Tips({title:"请选择配送时间"})}this.pay_close=!0},payCheck:function(t){this.payType=t,this.SubOrder()},getList:function(){var e=this,i=t.getStorageSync("user_longitude"),n=t.getStorageSync("user_latitude"),s={latitude:n,longitude:i,page:1,limit:10};(0,r.storeListApi)(s).then((function(t){var i=t.data.list.list||[];e.$set(e,"storeList",i),e.$set(e,"system_store",i[0])})).catch((function(t){}))},changeClose:function(){this.$set(this.address,"address",!1)},showStoreList:function(){this.storeList.length>0&&t.navigateTo({url:"/pages/users/goods_details_store/index"})},changePayType:function(t){this.payType=t,this.computedPrice()},computedPrice:function(){var t=this,e=this.shippingType;(0,s.postOrderComputed)(this.orderKey,{addressId:this.addressId,useIntegral:this.useIntegral?1:0,couponId:this.couponId,shipping_type:parseInt(e)+1,payType:this.payType}).then((function(i){var n=i.data.result;n&&(t.totalPrice=n.pay_price,t.integral_price=n.deduction_price,t.coupon_price=n.coupon_price,t.integral=t.useIntegral?n.SurplusIntegral:t.userInfo.integral,t.$set(t.priceGroup,"storePostage",1==e?0:n.pay_postage),t.$set(t.priceGroup,"storePostageDiscount",n.storePostageDiscount))}))},addressType:function(t){var e=t;this.shippingType=parseInt(e),this.computedPrice(),1==e&&this.getList()},bindPickerChange:function(t){var e=t.detail.value;this.shippingType=e,this.computedPrice()},ChangCouponsClone:function(){this.$set(this.coupon,"coupon",!1)},changeTextareaStatus:function(){for(var t=0,e=this.coupon.list.length;t<e;t++)this.coupon.list[t].use_title="",this.coupon.list[t].is_use=0;this.textareaStatus=!0,this.status=0,this.$set(this.coupon,"list",this.coupon.list)},ChangCoupons:function(t){for(var e=t,i=this.coupon.list,n="请选择",s=0,a=0,o=i.length;a<o;a++)a!=e&&(i[a].use_title="",i[a].is_use=0);i[e].is_use?(i[e].use_title="",i[e].is_use=0):(i[e].use_title="不使用",i[e].is_use=1,n=i[e].coupon_title,s=i[e].id),this.couponTitle=n,this.couponId=s,this.$set(this.coupon,"coupon",!1),this.$set(this.coupon,"list",i),this.computedPrice()},ChangeIntegral:function(){this.useIntegral=!this.useIntegral,this.computedPrice()},OnChangeAddress:function(t){this.textareaStatus=!0,this.addressId=t,this.address.address=!1,this.getConfirm(),this.getaddressInfo(),this.computedPrice()},bindHideKeyboard:function(t){this.mark=t.detail.value},getConfirm:function(){var e=this,i=this;t.showLoading({title:"订单加载中",mask:!0}),(0,s.orderConfirm)(i.cartId,i.news,i.addressId).then((function(n){i.$set(i,"userInfo",n.data.userInfo),i.$set(i,"integral",n.data.userInfo.integral),i.$set(i,"contacts",n.data.userInfo.real_name),i.$set(i,"contactsTel","0"===n.data.userInfo.record_phone?"":n.data.userInfo.record_phone),i.$set(i,"cartInfo",n.data.cartInfo),i.$set(i,"integralRatio",n.data.integralRatio),i.$set(i,"offlinePostage",n.data.offlinePostage),i.$set(i,"orderKey",n.data.orderKey),i.$set(i,"valid_count",n.data.valid_count),i.$set(i,"discount_id",n.data.discount_id),i.$set(i,"priceGroup",n.data.priceGroup),i.$set(i,"totalPrice",i.$util.$h.Add(parseFloat(n.data.priceGroup.totalPrice),parseFloat(n.data.priceGroup.storePostage))),i.$set(i,"seckillId",parseInt(n.data.seckill_id)),i.$set(i,"invoice_func",n.data.invoice_func),i.$set(i,"special_invoice",n.data.special_invoice),i.$set(i,"store_self_mention",n.data.store_self_mention),i.$set(i,"virtual_type",n.data.virtual_type||0),i.cartArr[0].payStatus=n.data.pay_weixin_open||0,i.cartArr[1].payStatus=n.data.ali_pay_status||0,i.cartArr[1].payStatus=0,i.cartArr[2].number=n.data.userInfo.now_money,i.cartArr[2].payStatus=1==n.data.yue_pay_status?n.data.yue_pay_status:0,2==n.data.offline_pay_status||n.data.deduction?i.cartArr[3].payStatus=0:i.cartArr[3].payStatus=1,i.$set(i,"ChangePrice",i.totalPrice),i.getBargainId(),i.getCouponList(),e.addressId&&e.computedPrice(),t.hideLoading()})).catch((function(i){return t.hideLoading(),e.$util.Tips({title:i})}))},getBargainId:function(){var t=this,e=t.cartInfo,i=0,n=0,s=0,a=0;e.forEach((function(t,e,o){i=o[e].bargain_id,n=o[e].combination_id,s=o[e].discount_id,a=o[e].advance_id})),t.$set(t,"BargainId",parseInt(i)),t.$set(t,"combinationId",parseInt(n)),t.$set(t,"discountId",parseInt(s)),t.$set(t,"advanceId",parseInt(a)),3==t.cartArr.length&&(i||n||t.seckillId||s)&&(t.cartArr[2].payStatus=0,t.$set(t,"cartArr",t.cartArr))},getCouponList:function(){var t=this,e={cartId:this.cartId,new:this.news};(0,s.getCouponsOrderPrice)(this.totalPrice,e).then((function(e){t.$set(t.coupon,"list",e.data),t.openType=1}))},getaddressInfo:function(){var t=this;t.addressId?(0,a.getAddressDetail)(t.addressId).then((function(e){e.data.is_default=parseInt(e.data.is_default),t.addressInfo=e.data||{},t.addressId=e.data.id||0,t.address.addressId=e.data.id||0})):(0,a.getAddressDefault)().then((function(e){e.data.is_default=parseInt(e.data.is_default),t.addressInfo=e.data||{},t.addressId=e.data.id||0,t.address.addressId=e.data.id||0}))},payItem:function(t){var e=this,i=t;e.active=i,e.animated=!0,e.payType=e.cartArr[i].value,e.computedPrice(),setTimeout((function(){e.car()}),500)},couponTap:function(){var t=this;this.coupon.coupon=!0,this.coupon.list.forEach((function(e,i){e.id==t.couponId?e.is_use=1:e.is_use=0})),this.$set(this.coupon,"list",this.coupon.list)},car:function(){var t=this;t.animated=!1},onAddress:function(){var e="APQBZ-MECCJ-QCJFY-FVSYX-MP3S7-SFBWG",i="AGA示例2",n="生活服务,娱乐休闲";t.navigateTo({url:"plugin://chooseLocation/index?key="+e+"&referer="+i+"&category="+n})},payment:function(e){var i=this,n=this;(0,s.orderCreate)(n.orderKey,e).then((function(e){var s=e.data.status,a=e.data.result.orderId,o=e.data.result.jsConfig,r="/pages/order_pay_status/index?order_id="+a+"&msg="+e.msg+"&type=3&totalPrice="+i.totalPrice;switch(s){case"ORDER_EXIST":case"EXTEND_ORDER":case"PAY_ERROR":return t.hideLoading(),n.$util.Tips({title:e.msg},{tab:5,url:r});case"SUCCESS":return t.hideLoading(),n.BargainId||n.combinationId||n.pinkId||n.seckillId||n.discountId?n.$util.Tips({title:e.msg,icon:"success"},{tab:4,url:r}):n.$util.Tips({title:e.msg,icon:"success"},{tab:5,url:r});case"WECHAT_PAY":n.toPay=!0,t.requestPayment({timeStamp:o.timestamp,nonceStr:o.nonceStr,package:o.package,signType:o.signType,paySign:o.paySign,success:function(e){return t.hideLoading(),n.BargainId||n.combinationId||n.pinkId||n.seckillId||n.discountId?n.$util.Tips({title:"支付成功",icon:"success"},{tab:4,url:r}):n.$util.Tips({title:"支付成功",icon:"success"},{tab:5,url:r})},fail:function(e){return t.hideLoading(),n.$util.Tips({title:"取消支付"},{tab:5,url:r+"&status=2"})},complete:function(i){if(t.hideLoading(),"requestPayment:cancel"==e.errMsg)return n.$util.Tips({title:"取消支付"},{tab:5,url:r+"&status=2"})}});break;case"PAY_DEFICIENCY":return t.hideLoading(),n.$util.Tips({title:e.msg},{tab:5,url:r+"&status=1"});case"WECHAT_H5_PAY":t.hideLoading(),n.$util.Tips({title:"订单创建成功!"},{tab:4,url:r+"&status=0"}),setTimeout((function(){location.href=e.data.result.jsConfig.mweb_url}),2e3);break;case"ALIPAY_PAY":t.navigateTo({url:"/pages/users/alipay_invoke/index?id=".concat(a,"&link=").concat(o.qrCode)});break}})).catch((function(e){return t.hideLoading(),n.$util.Tips({title:e})}))},clickTextArea:function(){this.$refs.textarea.focus()},SubOrder:function(e){var i=this,n={};if(!i.payType)return i.$util.Tips({title:"请选择支付方式"});if(0==i.shippingType){if(!i.addressMap.poiaddress&&!i.shippingType&&!i.virtual_type)return i.$util.Tips({title:"请选择收货地址"});if(!i.addressMap.real_name||!i.addressMap.phone)return i.$util.Tips({title:"请输入收货人姓名和收货人手机号"});if(!this.is_suitable&&!i.shippingType)return i.$util.Tips({title:"超过了配送范围！"});if(!i.dateTime)return i.$util.Tips({title:"请选择配送时间"})}if(1==i.shippingType){if(""==i.contacts||""==i.contactsTel)return i.$util.Tips({title:"请填写联系人或联系人电话"});if(!/^1(3|4|5|7|8|9|6)\d{9}$/.test(i.contactsTel))return i.$util.Tips({title:"请填写正确的手机号"});if(!i.contacts)return i.$util.Tips({title:"请填写您的真实姓名"});if(0==i.storeList.length)return i.$util.Tips({title:"暂无门店,请选择其他方式"})}if(n={real_name:i.contacts,phone:i.contactsTel,addressId:4,addressMap:i.addressMap,deliveryTime:i.dateTime,formId:"",couponId:i.couponId,payType:i.payType,useIntegral:i.useIntegral,bargainId:i.BargainId,combinationId:i.combinationId,discountId:i.discountId,pinkId:i.pinkId,advanceId:i.advanceId,seckill_id:i.seckillId,mark:i.mark,store_id:i.system_store?i.system_store.id:0,from:i.from,shipping_type:i.$util.$h.Add(i.shippingType,1),new:i.news,invoice_id:i.invChecked},"yue"==n.payType&&parseFloat(i.userInfo.now_money)<parseFloat(i.totalPrice))return i.$util.Tips({title:"余额不足！"});t.showLoading({title:"订单支付中"}),(0,o.openPaySubscribe)().then((function(){i.payment(n)}))}}};e.default=w}).call(this,i("543d")["default"])}},[["76d6","common/runtime","common/vendor"]]]);