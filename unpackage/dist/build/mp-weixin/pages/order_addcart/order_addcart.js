(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order_addcart/order_addcart"],{1738:function(t,e,i){},"17d2":function(t,e,i){},2410:function(t,e,i){"use strict";var r;i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){return r}));var a=function(){var t=this,e=t.$createElement;t._self._c},n=[]},2767:function(t,e,i){"use strict";i.r(e);var r=i("2cdf"),a=i.n(r);for(var n in r)"default"!==n&&function(t){i.d(e,t,(function(){return r[t]}))}(n);e["default"]=a.a},"2cdf":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r,a=l(i("a34a")),n=i("b4b4"),c=i("5e82"),s=i("2597"),o=i("26cb"),u=l(i("4757"));i("e5ac");function l(t){return t&&t.__esModule?t:{default:t}}function d(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function h(t,e,i,r,a,n,c){try{var s=t[n](c),o=s.value}catch(u){return void i(u)}s.done?e(o):Promise.resolve(o).then(r,a)}function f(t){return function(){var e=this,i=arguments;return new Promise((function(r,a){var n=t.apply(e,i);function c(t){h(n,r,a,c,s,"next",t)}function s(t){h(n,r,a,c,s,"throw",t)}c(void 0)}))}}var p=0,v=function(){Promise.all([i.e("common/vendor"),i.e("pages/index/components/tabBar")]).then(function(){return resolve(i("4da9"))}.bind(null,i)).catch(i.oe)},m=function(){Promise.all([i.e("common/vendor"),i.e("components/recommend/index")]).then(function(){return resolve(i("f2be"))}.bind(null,i)).catch(i.oe)},g=function(){i.e("components/productWindow/index").then(function(){return resolve(i("28ec"))}.bind(null,i)).catch(i.oe)},S=function(){i.e("components/Authorize").then(function(){return resolve(i("60e6"))}.bind(null,i)).catch(i.oe)},$=function(){Promise.all([i.e("common/vendor"),i.e("components/pageFooter/index")]).then(function(){return resolve(i("0781"))}.bind(null,i)).catch(i.oe)},_={components:{pageFooter:$,recommend:m,productWindow:g,tabBar:v,authorize:S},mixins:[u.default],data:function(){return{canShow:!1,cartCount:0,goodsHidden:!0,footerswitch:!0,hostProduct:[],cartList:{valid:[],invalid:[]},isAllSelect:!1,selectValue:[],selectCountPrice:0,isAuto:!1,isShowAuth:!1,hotScroll:!1,hotPage:1,hotLimit:10,loading:!1,loadend:!1,loadTitle:"我也是有底线的",page:1,limit:20,loadingInvalid:!1,loadendInvalid:!1,loadTitleInvalid:"加载更多",pageInvalid:1,limitInvalid:20,attr:{cartAttr:!1,productAttr:[],productSelect:{}},productValue:[],storeInfo:{},attrValue:"",attrTxt:"请选择",cartId:0,product_id:0,sysHeight:p,footerSee:!1,newData:{},activeRouter:""}},computed:(0,o.mapGetters)(["isLogin"]),onLoad:function(e){t.hideTabBar();var i=this;0==i.isLogin&&(0,s.toLogin)();var r=getCurrentPages(),a=r[r.length-1].route;this.activeRouter="/"+a},onShow:function(){this.canShow=!1,1==this.isLogin&&(this.hotPage=1,this.hostProduct=[],this.hotScroll=!1,this.getHostProduct(),this.loadend=!1,this.page=1,this.cartList.valid=[],this.getCartList(),this.loadendInvalid=!1,this.pageInvalid=1,this.cartList.invalid=[],this.getInvalidList(),this.getCartNum(),this.goodsHidden=!0,this.footerswitch=!0,this.hostProduct=[],this.hotScroll=!1,this.hotPage=1,this.hotLimit=10,this.cartList={valid:[],invalid:[]},this.isAllSelect=!1,this.selectValue=[],this.selectCountPrice=0,this.cartCount=0,this.isShowAuth=!1)},methods:(r={authColse:function(t){this.isShowAuth=t},reGoCat:function(){var t=this,e=t.productValue[this.attrValue];if(t.attr.productAttr.length&&void 0===e)return t.$util.Tips({title:"产品库存不足，请选择其它"});var i={id:t.cartId,product_id:t.product_id,num:t.attr.productSelect.cart_num,unique:void 0!==t.attr.productSelect?t.attr.productSelect.unique:""};(0,n.getResetCart)(i).then((function(e){t.attr.cartAttr=!1,t.$util.Tips({title:"添加购物车成功",success:function(){t.loadend=!1,t.page=1,t.cartList.valid=[],t.getCartList(),t.getCartNum()}})})).catch((function(e){return t.$util.Tips({title:e.msg})}))},onMyEvent:function(){this.$set(this.attr,"cartAttr",!1)},reElection:function(t){this.getGoodsDetails(t)},getGoodsDetails:function(e){t.showLoading({title:"加载中",mask:!0});var i=this;i.cartId=e.id,i.product_id=e.product_id,(0,c.getProductDetail)(e.product_id).then((function(e){t.hideLoading(),i.attr.cartAttr=!0;var r=e.data.storeInfo;i.$set(i,"storeInfo",r),i.$set(i.attr,"productAttr",e.data.productAttr),i.$set(i,"productValue",e.data.productValue),i.DefaultSelect()})).catch((function(e){t.hideLoading()}))},ChangeAttr:function(t){var e=this.productValue[t];e&&e.stock>0?(this.$set(this.attr.productSelect,"image",e.image),this.$set(this.attr.productSelect,"price",e.price),this.$set(this.attr.productSelect,"stock",e.stock),this.$set(this.attr.productSelect,"unique",e.unique),this.$set(this.attr.productSelect,"cart_num",1),this.$set(this,"attrValue",t),this.$set(this,"attrTxt","已选择")):(this.$set(this.attr.productSelect,"image",this.storeInfo.image),this.$set(this.attr.productSelect,"price",this.storeInfo.price),this.$set(this.attr.productSelect,"stock",0),this.$set(this.attr.productSelect,"unique",""),this.$set(this.attr.productSelect,"cart_num",0),this.$set(this,"attrValue",""),this.$set(this,"attrTxt","请选择"))},DefaultSelect:function(){var t=this.attr.productAttr,e=[];for(var i in this.productValue)if(this.productValue[i].stock>0){e=this.attr.productAttr.length?i.split(","):[];break}for(var r=0;r<t.length;r++)this.$set(t[r],"index",e[r]);var a=this.productValue[e.sort().join(",")];a&&t.length?(this.$set(this.attr.productSelect,"store_name",this.storeInfo.store_name),this.$set(this.attr.productSelect,"image",a.image),this.$set(this.attr.productSelect,"price",a.price),this.$set(this.attr.productSelect,"stock",a.stock),this.$set(this.attr.productSelect,"unique",a.unique),this.$set(this.attr.productSelect,"cart_num",1),this.$set(this,"attrValue",e.sort().join(",")),this.$set(this,"attrTxt","已选择")):!a&&t.length?(this.$set(this.attr.productSelect,"store_name",this.storeInfo.store_name),this.$set(this.attr.productSelect,"image",this.storeInfo.image),this.$set(this.attr.productSelect,"price",this.storeInfo.price),this.$set(this.attr.productSelect,"stock",0),this.$set(this.attr.productSelect,"unique",""),this.$set(this.attr.productSelect,"cart_num",0),this.$set(this,"attrValue",""),this.$set(this,"attrTxt","请选择")):a||t.length||(this.$set(this.attr.productSelect,"store_name",this.storeInfo.store_name),this.$set(this.attr.productSelect,"image",this.storeInfo.image),this.$set(this.attr.productSelect,"price",this.storeInfo.price),this.$set(this.attr.productSelect,"stock",this.storeInfo.stock),this.$set(this.attr.productSelect,"unique",this.storeInfo.unique||""),this.$set(this.attr.productSelect,"cart_num",1),this.$set(this,"attrValue",""),this.$set(this,"attrTxt","请选择"))},attrVal:function(t){this.$set(this.attr.productAttr[t.indexw],"index",this.attr.productAttr[t.indexw].attr_values[t.indexn])},ChangeCartNum:function(t){var e=this.productValue[this.attrValue];if(void 0!==e||this.attr.productAttr.length||(e=this.attr.productSelect),void 0!==e){var i=e.stock||0,r=this.attr.productSelect;t?(r.cart_num++,r.cart_num>i&&(this.$set(this.attr.productSelect,"cart_num",i||1),this.$set(this,"cart_num",i||1))):(r.cart_num--,r.cart_num<1&&(this.$set(this.attr.productSelect,"cart_num",1),this.$set(this,"cart_num",1)))}},iptCartNum:function(t){this.$set(this.attr.productSelect,"cart_num",t)},subDel:function(t){var e=this,i=e.selectValue;if(!(i.length>0))return e.$util.Tips({title:"请选择产品"});(0,n.cartDel)(i).then((function(t){e.loadend=!1,e.page=1,e.cartList.valid=[],e.getCartList(),e.getCartNum()}))},getSelectValueProductId:function(){var t=this,e=t.cartList.valid,i=t.selectValue,r=[];if(i.length>0)for(var a in e)t.inArray(e[a].id,i)&&r.push(e[a].product_id);return r},subCollect:function(t){var e=this,i=e.selectValue;if(!(i.length>0))return e.$util.Tips({title:"请选择产品"});e.getSelectValueProductId();(0,c.collectAll)(e.getSelectValueProductId().join(",")).then((function(t){return e.$util.Tips({title:t.msg,icon:"success"})})).catch((function(t){return e.$util.Tips({title:t})}))},subOrder:function(e){var i=this,r=i.selectValue;if(!(r.length>0))return i.$util.Tips({title:"请选择产品"});t.navigateTo({url:"/pages/users/order_confirm/index?cartId="+r.join(",")})},checkboxAllChange:function(t){var e=t.detail.value;e.length>0?this.setAllSelectValue(1):this.setAllSelectValue(0)},setAllSelectValue:function(t){var e=this,i=[],r=e.cartList.valid;if(r.length>0){var a=r.map((function(r){return t?(e.footerswitch?r.attrStatus?(r.checked=!0,i.push(r.id)):r.checked=!1:(r.checked=!0,i.push(r.id)),e.isAllSelect=!0):(r.checked=!1,e.isAllSelect=!1),r}));e.$set(e.cartList,"valid",a),e.selectValue=i,e.switchSelect()}},checkboxChange:function(t){var e=this,i=t.detail.value,r=e.cartList.valid,a=[],n=[],c=[],s=r.map((function(t){return e.inArray(t.id,i)?e.footerswitch?t.attrStatus?(t.checked=!0,a.push(t)):t.checked=!1:(t.checked=!0,a.push(t)):(t.checked=!1,n.push(t)),t}));e.footerswitch&&(c=n.filter((function(t){return!t.attrStatus}))),e.$set(e.cartList,"valid",s),e.isAllSelect=s.length===a.length+c.length,e.selectValue=i,e.switchSelect()},inArray:function(t,e){for(var i in e)if(e[i]==t)return!0;return!1},switchSelect:function(){var t=this,e=t.cartList.valid,i=t.selectValue,r=0;if(i.length<1)t.selectCountPrice=r;else{for(var a in e)t.inArray(e[a].id,i)&&(r=t.$util.$h.Add(r,t.$util.$h.Mul(e[a].cart_num,e[a].truePrice)));t.selectCountPrice=r}}},d(r,"iptCartNum",(function(t){var e=this.cartList.valid[t];e.cart_num&&this.setCartNum(e.id,e.cart_num),this.switchSelect()})),d(r,"blurInput",(function(t){var e=this.cartList.valid[t];e.cart_num||(e.cart_num=1,this.$set(this.cartList,"valid",this.cartList.valid))})),d(r,"subCart",(function(t){var e=this,i=!1,r=e.cartList.valid[t];r.cart_num=Number(r.cart_num)-1,r.cart_num<1&&(i=!0),r.cart_num<=1?(r.cart_num=1,r.numSub=!0):(r.numSub=!1,r.numAdd=!1),0==i&&e.setCartNum(r.id,r.cart_num,(function(i){e.cartList.valid[t]=r,e.getCartNum(),e.switchSelect()}))})),d(r,"addCart",(function(t){var e=this,i=e.cartList.valid[t];i.cart_num=Number(i.cart_num)+1;var r=i.productInfo;r.hasOwnProperty("attrInfo")&&i.cart_num>=i.productInfo.attrInfo.stock?(i.cart_num=i.productInfo.attrInfo.stock,i.numAdd=!0,i.numSub=!1):(i.numAdd=!1,i.numSub=!1),e.setCartNum(i.id,i.cart_num,(function(r){e.cartList.valid[t]=i,e.getCartNum(),e.switchSelect()}))})),d(r,"setCartNum",(function(t,e,i){(0,n.changeCartNum)(t,e).then((function(t){i&&i(t.data)}))})),d(r,"getCartNum",(function(){var t=this,e=this;(0,n.getCartCounts)().then((function(i){e.cartCount=i.data.count,t.$store.commit("indexData/setCartNum",i.data.count>99?"..":i.data.count),i.data.count>0?wx.setTabBarBadge({index:2,text:i.data.count+""}):wx.hideTabBarRedDot({index:2})}))})),d(r,"getCartData",(function(t){var e=this;return new Promise((function(i,r){(0,n.getCartList)(t).then((function(t){i(t.data)})).catch((function(t){e.loading=!1,e.canShow=!0,e.$util.Tips({title:t})}))}))})),d(r,"getCartList",(function(){var e=this;return f(a.default.mark((function i(){var r,c;return a.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:t.showLoading({title:"加载中",mask:!0}),r=e,c={page:r.page,limit:r.limit,status:1},(0,n.getCartCounts)().then(function(){var i=f(a.default.mark((function i(n){var s,o,u,l,d,h,f,p;return a.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:r.cartCount=n.data.count,s=0;case 2:if(!(s<Math.ceil(r.cartCount/r.limit))){i.next=20;break}return i.next=5,e.getCartData(c);case 5:if(o=i.sent,u=o.valid,l=r.$util.SplitArray(u,r.cartList.valid),[{numSub:!0},{numSub:!1}],[{numAdd:!0},{numAdd:!1}],d=[],l.length>0)for(h in l)1==l[h].cart_num?l[h].numSub=!0:l[h].numSub=!1,f=l[h].productInfo,f.hasOwnProperty("attrInfo")&&l[h].cart_num==l[h].productInfo.attrInfo.stock||l[h].cart_num==l[h].productInfo.stock?l[h].numAdd=!0:l[h].numAdd=!1,l[h].attrStatus?(l[h].checked=!0,d.push(l[h].id)):l[h].checked=!1;r.$set(r.cartList,"valid",l),c.page=r.page+1,r.selectValue=d,p=l.filter((function(t){return t.attrStatus})),r.isAllSelect=p.length==d.length&&p.length,r.switchSelect();case 17:s++,i.next=2;break;case 20:r.loading=!1,e.canShow=!0,t.hideLoading();case 23:case"end":return i.stop()}}),i)})));return function(t){return i.apply(this,arguments)}}());case 4:case"end":return i.stop()}}),i)})))()})),d(r,"getInvalidList",(function(){var t=this;if(this.loadendInvalid)return!1;if(this.loadingInvalid)return!1;var e={page:t.pageInvalid,limit:t.limitInvalid,status:0};(0,n.getCartList)(e).then((function(e){var i=e.data,r=i.invalid,a=r.length<t.limitInvalid,n=t.$util.SplitArray(r,t.cartList.invalid);t.$set(t.cartList,"invalid",n),t.loadendInvalid=a,t.loadTitleInvalid=a?"我也是有底线的":"加载更多",t.pageInvalid=t.pageInvalid+1,t.loadingInvalid=!1})).catch((function(e){t.loadingInvalid=!1,t.loadTitleInvalid="加载更多"}))})),d(r,"getHostProduct",(function(){var t=this;t.hotScroll||(0,c.getProductHot)(t.hotPage,t.hotLimit).then((function(e){t.hotPage++,t.hotScroll=e.data.length<t.hotLimit,t.hostProduct=t.hostProduct.concat(e.data)}))})),d(r,"goodsOpen",(function(){var t=this;t.goodsHidden=!t.goodsHidden})),d(r,"goRouter",(function(e){var i=getCurrentPages(),r=i[i.length-1].$page.fullPath;e.link!=r&&t.switchTab({url:e.link,fail:function(i){t.redirectTo({url:e.link})}})})),d(r,"manage",(function(){var t=this;t.footerswitch=!t.footerswitch;var e=[],i=[],r=t.cartList.valid.map((function(r){return t.footerswitch?r.attrStatus?r.checked&&e.push(r.id):(r.checked=!1,i.push(r)):r.checked&&e.push(r.id),r}));t.cartList.valid=r,t.footerswitch?t.isAllSelect=r.length===e.length+i.length:t.isAllSelect=r.length===e.length,t.selectValue=e,t.switchSelect()})),d(r,"unsetCart",(function(){for(var t=this,e=[],i=0,r=t.cartList.invalid.length;i<r;i++)e.push(t.cartList.invalid[i].id);(0,n.cartDel)(e).then((function(e){t.$util.Tips({title:"清除成功"}),t.$set(t.cartList,"invalid",[]),t.getCartNum()})).catch((function(t){}))})),r),onReachBottom:function(){var t=this;t.loadend&&t.getInvalidList(),0==t.cartList.valid.length&&0==t.cartList.invalid.length&&t.getHostProduct()}};e.default=_}).call(this,i("543d")["default"])},"4aa6":function(t,e,i){"use strict";var r=i("17d2"),a=i.n(r);a.a},b7ac:function(t,e,i){"use strict";i.r(e);var r=i("2410"),a=i("2767");for(var n in a)"default"!==n&&function(t){i.d(e,t,(function(){return a[t]}))}(n);i("4aa6"),i("d838");var c,s=i("f0c5"),o=Object(s["a"])(a["default"],r["b"],r["c"],!1,null,"36bb99ea",null,!1,r["a"],c);e["default"]=o.exports},d838:function(t,e,i){"use strict";var r=i("1738"),a=i.n(r);a.a},f6f7:function(t,e,i){"use strict";(function(t){i("b632");r(i("66fd"));var e=r(i("b7ac"));function r(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=i,t(e.default)}).call(this,i("543d")["createPage"])}},[["f6f7","common/runtime","common/vendor"]]]);